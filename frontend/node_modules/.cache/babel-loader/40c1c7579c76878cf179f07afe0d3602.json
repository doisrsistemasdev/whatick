{"ast":null,"code":"import _slicedToArray from\"/Users/jucenirleonardo/Documents/GitHub/whaticket_saas/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _defineProperty from\"/Users/jucenirleonardo/Documents/GitHub/whaticket_saas/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import React,{useContext,useEffect,useRef,useState}from\"react\";import{useHistory}from\"react-router-dom\";import{makeStyles}from\"@material-ui/core/styles\";import Paper from\"@material-ui/core/Paper\";import SearchIcon from\"@material-ui/icons/Search\";import InputBase from\"@material-ui/core/InputBase\";import Tabs from\"@material-ui/core/Tabs\";import Tab from\"@material-ui/core/Tab\";import Badge from\"@material-ui/core/Badge\";import MoveToInboxIcon from\"@material-ui/icons/MoveToInbox\";import CheckBoxIcon from\"@material-ui/icons/CheckBox\";import FormControlLabel from\"@material-ui/core/FormControlLabel\";import Switch from\"@material-ui/core/Switch\";import NewTicketModal from\"../NewTicketModal\";import TicketsList from\"../TicketsListCustom\";import TabPanel from\"../TabPanel\";import{i18n}from\"../../translate/i18n\";import{AuthContext}from\"../../context/Auth/AuthContext\";import{Can}from\"../Can\";import TicketsQueueSelect from\"../TicketsQueueSelect\";import{Button}from\"@material-ui/core\";import{TagsFilter}from\"../TagsFilter\";import{UsersFilter}from\"../UsersFilter\";var useStyles=makeStyles(function(theme){return{ticketsWrapper:{position:\"relative\",display:\"flex\",height:\"100%\",flexDirection:\"column\",overflow:\"hidden\",borderTopRightRadius:0,borderBottomRightRadius:0,borderRadius:0},tabsHeader:{flex:\"none\",backgroundColor:theme.palette.tabHeaderBackground},tabsInternal:{flex:\"none\",backgroundColor:theme.palette.tabHeaderBackground},settingsIcon:{alignSelf:\"center\",marginLeft:\"auto\",padding:8},tab:{minWidth:120,width:120},internalTab:{minWidth:120,width:120,padding:5},ticketOptionsBox:{display:\"flex\",justifyContent:\"space-between\",alignItems:\"center\",background:theme.palette.optionsBackground,padding:theme.spacing(1)},ticketSearchLine:{padding:theme.spacing(1)},serachInputWrapper:{flex:1,background:theme.palette.total,display:\"flex\",borderRadius:40,padding:4,marginRight:theme.spacing(1)},searchIcon:{color:\"grey\",marginLeft:6,marginRight:6,alignSelf:\"center\"},searchInput:{flex:1,border:\"none\",borderRadius:30},insiderTabPanel:{height:'100%',marginTop:\"-72px\",paddingTop:\"72px\"},insiderDoubleTabPanel:{display:\"flex\",flexDirection:\"column\",marginTop:\"-72px\",paddingTop:\"72px\",height:\"100%\"},labelContainer:{width:\"auto\",padding:0},iconLabelWrapper:{flexDirection:\"row\",'& > *:first-child':{marginBottom:'3px !important',marginRight:16}},insiderTabLabel:_defineProperty({},theme.breakpoints.down(1600),{display:'none'}),smallFormControl:{'& .MuiOutlinedInput-input':{padding:\"12px 10px\"},'& .MuiInputLabel-outlined':{marginTop:\"-6px\"}}};});var TicketsManagerTabs=function TicketsManagerTabs(){var classes=useStyles();var history=useHistory();var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),searchParam=_useState2[0],setSearchParam=_useState2[1];var _useState3=useState(\"open\"),_useState4=_slicedToArray(_useState3,2),tab=_useState4[0],setTab=_useState4[1];var _useState5=useState(\"open\"),_useState6=_slicedToArray(_useState5,2),tabOpen=_useState6[0],setTabOpen=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),newTicketModalOpen=_useState8[0],setNewTicketModalOpen=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),showAllTickets=_useState10[0],setShowAllTickets=_useState10[1];var searchInputRef=useRef();var _useContext=useContext(AuthContext),user=_useContext.user;var profile=user.profile;var _useState11=useState(0),_useState12=_slicedToArray(_useState11,2),openCount=_useState12[0],setOpenCount=_useState12[1];var _useState13=useState(0),_useState14=_slicedToArray(_useState13,2),pendingCount=_useState14[0],setPendingCount=_useState14[1];var userQueueIds=user.queues.map(function(q){return q.id;});var _useState15=useState(userQueueIds||[]),_useState16=_slicedToArray(_useState15,2),selectedQueueIds=_useState16[0],setSelectedQueueIds=_useState16[1];var _useState17=useState([]),_useState18=_slicedToArray(_useState17,2),selectedTags=_useState18[0],setSelectedTags=_useState18[1];var _useState19=useState([]),_useState20=_slicedToArray(_useState19,2),selectedUsers=_useState20[0],setSelectedUsers=_useState20[1];useEffect(function(){if(user.profile.toUpperCase()===\"ADMIN\"){setShowAllTickets(true);}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);useEffect(function(){if(tab===\"search\"){searchInputRef.current.focus();}},[tab]);var searchTimeout;var handleSearch=function handleSearch(e){var searchedTerm=e.target.value.toLowerCase();clearTimeout(searchTimeout);if(searchedTerm===\"\"){setSearchParam(searchedTerm);setTab(\"open\");return;}searchTimeout=setTimeout(function(){setSearchParam(searchedTerm);},500);};var handleChangeTab=function handleChangeTab(e,newValue){setTab(newValue);};var handleChangeTabOpen=function handleChangeTabOpen(e,newValue){setTabOpen(newValue);};var applyPanelStyle=function applyPanelStyle(status){if(tabOpen!==status){return{width:0,height:0};}};var handleCloseOrOpenTicket=function handleCloseOrOpenTicket(ticket){setNewTicketModalOpen(false);if(ticket!==undefined&&ticket.uuid!==undefined){history.push(\"/tickets/\".concat(ticket.uuid));}};var handleSelectedTags=function handleSelectedTags(selecteds){var tags=selecteds.map(function(t){return t.id;});setSelectedTags(tags);};var handleSelectedUsers=function handleSelectedUsers(selecteds){var users=selecteds.map(function(t){return t.id;});setSelectedUsers(users);};return/*#__PURE__*/React.createElement(Paper,{elevation:0,variant:\"outlined\",className:classes.ticketsWrapper},/*#__PURE__*/React.createElement(NewTicketModal,{modalOpen:newTicketModalOpen,onClose:function onClose(ticket){console.log(\"ticket\",ticket);handleCloseOrOpenTicket(ticket);}}),/*#__PURE__*/React.createElement(Paper,{elevation:0,square:true,className:classes.tabsHeader},/*#__PURE__*/React.createElement(Tabs,{value:tab,onChange:handleChangeTab,variant:\"fullWidth\",indicatorColor:\"primary\",textColor:\"primary\",\"aria-label\":\"icon label tabs example\"},/*#__PURE__*/React.createElement(Tab,{value:\"open\",icon:/*#__PURE__*/React.createElement(MoveToInboxIcon,null),label:i18n.t(\"tickets.tabs.open.title\"),classes:{root:classes.tab}}),/*#__PURE__*/React.createElement(Tab,{value:\"closed\",icon:/*#__PURE__*/React.createElement(CheckBoxIcon,null),label:i18n.t(\"tickets.tabs.closed.title\"),classes:{root:classes.tab}}),/*#__PURE__*/React.createElement(Tab,{value:\"search\",icon:/*#__PURE__*/React.createElement(SearchIcon,null),label:i18n.t(\"tickets.tabs.search.title\"),classes:{root:classes.tab}}))),/*#__PURE__*/React.createElement(Paper,{square:true,elevation:0,className:classes.ticketOptionsBox},tab===\"search\"?/*#__PURE__*/React.createElement(\"div\",{className:classes.serachInputWrapper},/*#__PURE__*/React.createElement(SearchIcon,{className:classes.searchIcon}),/*#__PURE__*/React.createElement(InputBase,{className:classes.searchInput,inputRef:searchInputRef,placeholder:i18n.t(\"tickets.search.placeholder\"),type:\"search\",onChange:handleSearch})):/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Button,{variant:\"outlined\",color:\"primary\",onClick:function onClick(){return setNewTicketModalOpen(true);}},i18n.t(\"ticketsManager.buttons.newTicket\")),/*#__PURE__*/React.createElement(Can,{role:user.profile,perform:\"tickets-manager:showall\",yes:function yes(){return/*#__PURE__*/React.createElement(FormControlLabel,{label:i18n.t(\"tickets.buttons.showAll\"),labelPlacement:\"start\",control:/*#__PURE__*/React.createElement(Switch,{size:\"small\",checked:showAllTickets,onChange:function onChange(){return setShowAllTickets(function(prevState){return!prevState;});},name:\"showAllTickets\",color:\"primary\"})});}})),/*#__PURE__*/React.createElement(TicketsQueueSelect,{style:{marginLeft:6},selectedQueueIds:selectedQueueIds,userQueues:user===null||user===void 0?void 0:user.queues,onChange:function onChange(values){return setSelectedQueueIds(values);}})),/*#__PURE__*/React.createElement(TabPanel,{value:tab,name:\"open\",className:classes.ticketsWrapper},/*#__PURE__*/React.createElement(Tabs,{value:tabOpen,onChange:handleChangeTabOpen,indicatorColor:\"primary\",textColor:\"primary\",variant:\"fullWidth\"},/*#__PURE__*/React.createElement(Tab,{label:/*#__PURE__*/React.createElement(Badge,{className:classes.badge,badgeContent:openCount,color:\"primary\"},i18n.t(\"ticketsList.assignedHeader\")),value:\"open\"}),/*#__PURE__*/React.createElement(Tab,{label:/*#__PURE__*/React.createElement(Badge,{className:classes.badge,badgeContent:pendingCount,color:\"secondary\"},i18n.t(\"ticketsList.pendingHeader\")),value:\"pending\"})),/*#__PURE__*/React.createElement(Paper,{className:classes.ticketsWrapper},/*#__PURE__*/React.createElement(TicketsList,{status:\"open\",showAll:showAllTickets,selectedQueueIds:selectedQueueIds,updateCount:function updateCount(val){return setOpenCount(val);},style:applyPanelStyle(\"open\")}),/*#__PURE__*/React.createElement(TicketsList,{status:\"pending\",selectedQueueIds:selectedQueueIds,updateCount:function updateCount(val){return setPendingCount(val);},style:applyPanelStyle(\"pending\")}))),/*#__PURE__*/React.createElement(TabPanel,{value:tab,name:\"closed\",className:classes.ticketsWrapper},/*#__PURE__*/React.createElement(TicketsList,{status:\"closed\",showAll:true,selectedQueueIds:selectedQueueIds})),/*#__PURE__*/React.createElement(TabPanel,{value:tab,name:\"search\",className:classes.ticketsWrapper},/*#__PURE__*/React.createElement(TagsFilter,{onFiltered:handleSelectedTags}),profile===\"admin\"&&/*#__PURE__*/React.createElement(UsersFilter,{onFiltered:handleSelectedUsers}),/*#__PURE__*/React.createElement(TicketsList,{searchParam:searchParam,showAll:true,tags:selectedTags,users:selectedUsers,selectedQueueIds:selectedQueueIds})));};export default TicketsManagerTabs;","map":null,"metadata":{},"sourceType":"module"}