{"ast":null,"code":"import _slicedToArray from\"/Users/jucenirleonardo/Documents/GitHub/whaticket_saas/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _objectSpread from\"/Users/jucenirleonardo/Documents/GitHub/whaticket_saas/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import React,{useContext,useEffect,useRef,useState}from\"react\";import{Box,FormControl,IconButton,Input,InputAdornment,makeStyles,Paper,Typography}from\"@material-ui/core\";import SendIcon from\"@material-ui/icons/Send\";import{AuthContext}from\"../../context/Auth/AuthContext\";import{useDate}from\"../../hooks/useDate\";import api from\"../../services/api\";var useStyles=makeStyles(function(theme){return{mainContainer:{display:\"flex\",flexDirection:\"column\",position:\"relative\",flex:1,overflow:\"hidden\",borderRadius:0,height:\"100%\",borderLeft:\"1px solid rgba(0, 0, 0, 0.12)\"},messageList:_objectSpread(_objectSpread({position:\"relative\",overflowY:\"auto\",height:\"100%\"},theme.scrollbarStyles),{},{backgroundColor:\"#eee\"}),inputArea:{position:\"relative\",height:\"auto\"},input:{padding:\"20px\"},buttonSend:{margin:theme.spacing(1)},boxLeft:{padding:\"10px 10px 5px\",margin:\"10px\",position:\"relative\",backgroundColor:\"white\",maxWidth:300,borderRadius:10,borderBottomLeftRadius:0,border:\"1px solid rgba(0, 0, 0, 0.12)\"},boxRight:{padding:\"10px 10px 5px\",margin:\"10px 10px 10px auto\",position:\"relative\",backgroundColor:\"#E3F3F9\",textAlign:\"right\",maxWidth:300,borderRadius:10,borderBottomRightRadius:0,border:\"1px solid rgba(0, 0, 0, 0.12)\"}};});export default function ChatMessages(_ref){var chat=_ref.chat,messages=_ref.messages,handleSendMessage=_ref.handleSendMessage,handleLoadMore=_ref.handleLoadMore,scrollToBottomRef=_ref.scrollToBottomRef,pageInfo=_ref.pageInfo,loading=_ref.loading;var classes=useStyles();var _useContext=useContext(AuthContext),user=_useContext.user;var _useDate=useDate(),datetimeToClient=_useDate.datetimeToClient;var baseRef=useRef();var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),contentMessage=_useState2[0],setContentMessage=_useState2[1];var scrollToBottom=function scrollToBottom(){if(baseRef.current){baseRef.current.scrollIntoView({});}};var unreadMessages=function unreadMessages(chat){if(chat!==undefined){var currentUser=chat.users.find(function(u){return u.userId===user.id;});return currentUser.unreads>0;}return 0;};useEffect(function(){if(unreadMessages(chat)>0){try{api.post(\"/chats/\".concat(chat.id,\"/read\"),{userId:user.id});}catch(err){}}scrollToBottomRef.current=scrollToBottom;// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);var handleScroll=function handleScroll(e){var scrollTop=e.currentTarget.scrollTop;if(!pageInfo.hasMore||loading)return;if(scrollTop<600){handleLoadMore();}};return/*#__PURE__*/React.createElement(Paper,{className:classes.mainContainer},/*#__PURE__*/React.createElement(\"div\",{onScroll:handleScroll,className:classes.messageList},Array.isArray(messages)&&messages.map(function(item,key){if(item.senderId===user.id){return/*#__PURE__*/React.createElement(Box,{key:key,className:classes.boxRight},/*#__PURE__*/React.createElement(Typography,{variant:\"subtitle2\"},item.sender.name),item.message,/*#__PURE__*/React.createElement(Typography,{variant:\"caption\",display:\"block\"},datetimeToClient(item.createdAt)));}else{return/*#__PURE__*/React.createElement(Box,{key:key,className:classes.boxLeft},/*#__PURE__*/React.createElement(Typography,{variant:\"subtitle2\"},item.sender.name),item.message,/*#__PURE__*/React.createElement(Typography,{variant:\"caption\",display:\"block\"},datetimeToClient(item.createdAt)));}}),/*#__PURE__*/React.createElement(\"div\",{ref:baseRef})),/*#__PURE__*/React.createElement(\"div\",{className:classes.inputArea},/*#__PURE__*/React.createElement(FormControl,{variant:\"outlined\",fullWidth:true},/*#__PURE__*/React.createElement(Input,{multiline:true,value:contentMessage,onKeyUp:function onKeyUp(e){if(e.key===\"Enter\"&&contentMessage.trim()!==\"\"){handleSendMessage(contentMessage);setContentMessage(\"\");}},onChange:function onChange(e){return setContentMessage(e.target.value);},className:classes.input,endAdornment:/*#__PURE__*/React.createElement(InputAdornment,{position:\"end\"},/*#__PURE__*/React.createElement(IconButton,{onClick:function onClick(){if(contentMessage.trim()!==\"\"){handleSendMessage(contentMessage);setContentMessage(\"\");}},className:classes.buttonSend},/*#__PURE__*/React.createElement(SendIcon,null)))}))));}","map":null,"metadata":{},"sourceType":"module"}