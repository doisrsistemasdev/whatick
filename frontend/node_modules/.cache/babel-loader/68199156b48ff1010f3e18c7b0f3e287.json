{"ast":null,"code":"var _jsxFileName = \"/Users/jucenirleonardo/Documents/GitHub/whaticket_saas/frontend/src/components/QrcodeModal/index.js\";\nimport React, { useEffect, useState } from \"react\";\nimport QRCode from \"qrcode.react\";\nimport toastError from \"../../errors/toastError\";\nimport { Dialog, DialogContent, Paper, Typography } from \"@material-ui/core\";\nimport { i18n } from \"../../translate/i18n\";\nimport api from \"../../services/api\";\nimport { socketConnection } from \"../../services/socket\";\nconst QrcodeModal = _ref => {\n  let {\n    open,\n    onClose,\n    whatsAppId\n  } = _ref;\n  const [qrCode, setQrCode] = useState(\"\");\n  useEffect(() => {\n    const fetchSession = async () => {\n      if (!whatsAppId) return;\n      try {\n        const {\n          data\n        } = await api.get(`/whatsapp/${whatsAppId}`);\n        setQrCode(data.qrcode);\n      } catch (err) {\n        toastError(err);\n      }\n    };\n    fetchSession();\n  }, [whatsAppId]);\n  useEffect(() => {\n    if (!whatsAppId) return;\n    const companyId = localStorage.getItem(\"companyId\");\n    const socket = socketConnection({\n      companyId\n    });\n    socket.on(`company-${companyId}-whatsappSession`, data => {\n      if (data.action === \"update\" && data.session.id === whatsAppId) {\n        setQrCode(data.session.qrcode);\n      }\n      if (data.action === \"update\" && data.session.qrcode === \"\") {\n        onClose();\n      }\n    });\n    return () => {\n      socket.disconnect();\n    };\n  }, [whatsAppId, onClose]);\n  return /*#__PURE__*/React.createElement(Dialog, {\n    open: open,\n    onClose: onClose,\n    maxWidth: \"lg\",\n    scroll: \"paper\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 48,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(DialogContent, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 49,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Paper, {\n    elevation: 0,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 50,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    color: \"primary\",\n    gutterBottom: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 51,\n      columnNumber: 11\n    }\n  }, i18n.t(\"qrCode.message\")), qrCode ? /*#__PURE__*/React.createElement(QRCode, {\n    value: qrCode,\n    size: 256,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 55,\n      columnNumber: 13\n    }\n  }) : /*#__PURE__*/React.createElement(\"span\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 57,\n      columnNumber: 13\n    }\n  }, \"Waiting for QR Code\"))));\n};\nexport default React.memo(QrcodeModal);","map":{"version":3,"names":["React","useEffect","useState","QRCode","toastError","Dialog","DialogContent","Paper","Typography","i18n","api","socketConnection","QrcodeModal","_ref","open","onClose","whatsAppId","qrCode","setQrCode","fetchSession","data","get","qrcode","err","companyId","localStorage","getItem","socket","on","action","session","id","disconnect","createElement","maxWidth","scroll","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","elevation","color","gutterBottom","t","value","size","memo"],"sources":["/Users/jucenirleonardo/Documents/GitHub/whaticket_saas/frontend/src/components/QrcodeModal/index.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport QRCode from \"qrcode.react\";\nimport toastError from \"../../errors/toastError\";\n\nimport { Dialog, DialogContent, Paper, Typography } from \"@material-ui/core\";\nimport { i18n } from \"../../translate/i18n\";\nimport api from \"../../services/api\";\nimport { socketConnection } from \"../../services/socket\";\n\nconst QrcodeModal = ({ open, onClose, whatsAppId }) => {\n  const [qrCode, setQrCode] = useState(\"\");\n\n  useEffect(() => {\n    const fetchSession = async () => {\n      if (!whatsAppId) return;\n\n      try {\n        const { data } = await api.get(`/whatsapp/${whatsAppId}`);\n        setQrCode(data.qrcode);\n      } catch (err) {\n        toastError(err);\n      }\n    };\n    fetchSession();\n  }, [whatsAppId]);\n\n  useEffect(() => {\n    if (!whatsAppId) return;\n    const companyId = localStorage.getItem(\"companyId\");\n    const socket = socketConnection({ companyId });\n\n    socket.on(`company-${companyId}-whatsappSession`, (data) => {\n      if (data.action === \"update\" && data.session.id === whatsAppId) {\n        setQrCode(data.session.qrcode);\n      }\n\n      if (data.action === \"update\" && data.session.qrcode === \"\") {\n        onClose();\n      }\n    });\n\n    return () => {\n      socket.disconnect();\n    };\n  }, [whatsAppId, onClose]);\n\n  return (\n    <Dialog open={open} onClose={onClose} maxWidth=\"lg\" scroll=\"paper\">\n      <DialogContent>\n        <Paper elevation={0}>\n          <Typography color=\"primary\" gutterBottom>\n            {i18n.t(\"qrCode.message\")}\n          </Typography>\n          {qrCode ? (\n            <QRCode value={qrCode} size={256} />\n          ) : (\n            <span>Waiting for QR Code</span>\n          )}\n        </Paper>\n      </DialogContent>\n    </Dialog>\n  );\n};\n\nexport default React.memo(QrcodeModal);\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}