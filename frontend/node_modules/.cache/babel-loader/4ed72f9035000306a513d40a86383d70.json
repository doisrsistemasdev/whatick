{"ast":null,"code":"var _jsxFileName = \"/Users/jucenirleonardo/Documents/GitHub/whaticket_saas/frontend/src/components/NotificationsPopOver/index.js\";\nimport React, { useState, useRef, useEffect, useContext } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport { format } from \"date-fns\";\nimport useSound from \"use-sound\";\nimport Popover from \"@material-ui/core/Popover\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport List from \"@material-ui/core/List\";\nimport ListItem from \"@material-ui/core/ListItem\";\nimport ListItemText from \"@material-ui/core/ListItemText\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport Badge from \"@material-ui/core/Badge\";\nimport ChatIcon from \"@material-ui/icons/Chat\";\nimport TicketListItem from \"../TicketListItem\";\nimport { i18n } from \"../../translate/i18n\";\nimport useTickets from \"../../hooks/useTickets\";\nimport alertSound from \"../../assets/sound.mp3\";\nimport { AuthContext } from \"../../context/Auth/AuthContext\";\nimport { socketConnection } from \"../../services/socket\";\nconst useStyles = makeStyles(theme => ({\n  tabContainer: {\n    overflowY: \"auto\",\n    maxHeight: 350,\n    ...theme.scrollbarStyles\n  },\n  popoverPaper: {\n    width: \"100%\",\n    maxWidth: 350,\n    marginLeft: theme.spacing(2),\n    marginRight: theme.spacing(1),\n    [theme.breakpoints.down(\"sm\")]: {\n      maxWidth: 270\n    }\n  },\n  noShadow: {\n    boxShadow: \"none !important\"\n  }\n}));\nconst NotificationsPopOver = () => {\n  const classes = useStyles();\n  const history = useHistory();\n  const {\n    user\n  } = useContext(AuthContext);\n  const ticketIdUrl = +history.location.pathname.split(\"/\")[2];\n  const ticketIdRef = useRef(ticketIdUrl);\n  const anchorEl = useRef();\n  const [isOpen, setIsOpen] = useState(false);\n  const [notifications, setNotifications] = useState([]);\n  const {\n    profile,\n    queues\n  } = user;\n  const [, setDesktopNotifications] = useState([]);\n  const {\n    tickets\n  } = useTickets({\n    withUnreadMessages: \"true\"\n  });\n  const [play] = useSound(alertSound);\n  const soundAlertRef = useRef();\n  const historyRef = useRef(history);\n  useEffect(() => {\n    soundAlertRef.current = play;\n    if (!(\"Notification\" in window)) {\n      console.log(\"This browser doesn't support notifications\");\n    } else {\n      Notification.requestPermission();\n    }\n  }, [play]);\n  useEffect(() => {\n    setNotifications(tickets);\n  }, [tickets]);\n  useEffect(() => {\n    ticketIdRef.current = ticketIdUrl;\n  }, [ticketIdUrl]);\n  useEffect(() => {\n    const companyId = localStorage.getItem(\"companyId\");\n    const socket = socketConnection({\n      companyId\n    });\n    const queueIds = queues.map(q => q.id);\n    socket.on(\"connect\", () => socket.emit(\"joinNotification\"));\n    socket.on(`company-${companyId}-ticket`, data => {\n      if (data.action === \"updateUnread\" || data.action === \"delete\") {\n        setNotifications(prevState => {\n          const ticketIndex = prevState.findIndex(t => t.id === data.ticketId);\n          if (ticketIndex !== -1) {\n            prevState.splice(ticketIndex, 1);\n            return [...prevState];\n          }\n          return prevState;\n        });\n        setDesktopNotifications(prevState => {\n          const notfiticationIndex = prevState.findIndex(n => n.tag === String(data.ticketId));\n          if (notfiticationIndex !== -1) {\n            prevState[notfiticationIndex].close();\n            prevState.splice(notfiticationIndex, 1);\n            return [...prevState];\n          }\n          return prevState;\n        });\n      }\n    });\n    socket.on(`company-${companyId}-appMessage`, data => {\n      if (data.action === \"create\" && !data.message.read && (data.ticket.userId === (user === null || user === void 0 ? void 0 : user.id) || !data.ticket.userId)) {\n        setNotifications(prevState => {\n          const ticketIndex = prevState.findIndex(t => t.id === data.ticket.id);\n          if (ticketIndex !== -1) {\n            prevState[ticketIndex] = data.ticket;\n            return [...prevState];\n          }\n          return [data.ticket, ...prevState];\n        });\n        const shouldNotNotificate = data.message.ticketId === ticketIdRef.current && document.visibilityState === \"visible\" || data.ticket.userId && data.ticket.userId !== (user === null || user === void 0 ? void 0 : user.id) || data.ticket.isGroup;\n        if (shouldNotNotificate) return;\n        handleNotifications(data);\n      }\n    });\n    return () => {\n      socket.disconnect();\n    };\n  }, [user, profile, queues]);\n  const handleNotifications = data => {\n    const {\n      message,\n      contact,\n      ticket\n    } = data;\n    const options = {\n      body: `${message.body} - ${format(new Date(), \"HH:mm\")}`,\n      icon: contact.profilePicUrl,\n      tag: ticket.id,\n      renotify: true\n    };\n    const notification = new Notification(`${i18n.t(\"tickets.notification.message\")} ${contact.name}`, options);\n    notification.onclick = e => {\n      e.preventDefault();\n      window.focus();\n      historyRef.current.push(`/tickets/${ticket.uuid}`);\n    };\n    setDesktopNotifications(prevState => {\n      const notfiticationIndex = prevState.findIndex(n => n.tag === notification.tag);\n      if (notfiticationIndex !== -1) {\n        prevState[notfiticationIndex] = notification;\n        return [...prevState];\n      }\n      return [notification, ...prevState];\n    });\n    soundAlertRef.current();\n  };\n  const handleClick = () => {\n    setIsOpen(prevState => !prevState);\n  };\n  const handleClickAway = () => {\n    setIsOpen(false);\n  };\n  const NotificationTicket = _ref => {\n    let {\n      children\n    } = _ref;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      onClick: handleClickAway,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 12\n      }\n    }, children);\n  };\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(IconButton, {\n    onClick: handleClick,\n    ref: anchorEl,\n    \"aria-label\": \"Mostrar Notifica\\xE7\\xF5es\",\n    variant: \"contained\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(ChatIcon, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 11\n    }\n  })), /*#__PURE__*/React.createElement(Popover, {\n    disableScrollLock: true,\n    open: isOpen,\n    anchorEl: anchorEl.current,\n    anchorOrigin: {\n      vertical: \"bottom\",\n      horizontal: \"right\"\n    },\n    transformOrigin: {\n      vertical: \"top\",\n      horizontal: \"right\"\n    },\n    classes: {\n      paper: classes.popoverPaper\n    },\n    onClose: handleClickAway,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(List, {\n    dense: true,\n    className: classes.tabContainer,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 9\n    }\n  }, notifications.length === 0 ? /*#__PURE__*/React.createElement(ListItem, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 223,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(ListItemText, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 224,\n      columnNumber: 15\n    }\n  }, i18n.t(\"notifications.noTickets\"))) : notifications.map(ticket => /*#__PURE__*/React.createElement(NotificationTicket, {\n    key: ticket.id,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(TicketListItem, {\n    ticket: ticket,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 17\n    }\n  }))))));\n};\nexport default NotificationsPopOver;","map":{"version":3,"names":["React","useState","useRef","useEffect","useContext","useHistory","format","useSound","Popover","IconButton","List","ListItem","ListItemText","makeStyles","Badge","ChatIcon","TicketListItem","i18n","useTickets","alertSound","AuthContext","socketConnection","useStyles","theme","tabContainer","overflowY","maxHeight","scrollbarStyles","popoverPaper","width","maxWidth","marginLeft","spacing","marginRight","breakpoints","down","noShadow","boxShadow","NotificationsPopOver","classes","history","user","ticketIdUrl","location","pathname","split","ticketIdRef","anchorEl","isOpen","setIsOpen","notifications","setNotifications","profile","queues","setDesktopNotifications","tickets","withUnreadMessages","play","soundAlertRef","historyRef","current","window","console","log","Notification","requestPermission","companyId","localStorage","getItem","socket","queueIds","map","q","id","on","emit","data","action","prevState","ticketIndex","findIndex","t","ticketId","splice","notfiticationIndex","n","tag","String","close","message","read","ticket","userId","shouldNotNotificate","document","visibilityState","isGroup","handleNotifications","disconnect","contact","options","body","Date","icon","profilePicUrl","renotify","notification","name","onclick","e","preventDefault","focus","push","uuid","handleClick","handleClickAway","NotificationTicket","_ref","children","createElement","onClick","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","Fragment","ref","variant","disableScrollLock","open","anchorOrigin","vertical","horizontal","transformOrigin","paper","onClose","dense","className","length","key"],"sources":["/Users/jucenirleonardo/Documents/GitHub/whaticket_saas/frontend/src/components/NotificationsPopOver/index.js"],"sourcesContent":["import React, { useState, useRef, useEffect, useContext } from \"react\";\n\nimport { useHistory } from \"react-router-dom\";\nimport { format } from \"date-fns\";\nimport useSound from \"use-sound\";\n\nimport Popover from \"@material-ui/core/Popover\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport List from \"@material-ui/core/List\";\nimport ListItem from \"@material-ui/core/ListItem\";\nimport ListItemText from \"@material-ui/core/ListItemText\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport Badge from \"@material-ui/core/Badge\";\nimport ChatIcon from \"@material-ui/icons/Chat\";\n\nimport TicketListItem from \"../TicketListItem\";\nimport { i18n } from \"../../translate/i18n\";\nimport useTickets from \"../../hooks/useTickets\";\nimport alertSound from \"../../assets/sound.mp3\";\nimport { AuthContext } from \"../../context/Auth/AuthContext\";\nimport { socketConnection } from \"../../services/socket\";\n\nconst useStyles = makeStyles((theme) => ({\n  tabContainer: {\n    overflowY: \"auto\",\n    maxHeight: 350,\n    ...theme.scrollbarStyles,\n  },\n  popoverPaper: {\n    width: \"100%\",\n    maxWidth: 350,\n    marginLeft: theme.spacing(2),\n    marginRight: theme.spacing(1),\n    [theme.breakpoints.down(\"sm\")]: {\n      maxWidth: 270,\n    },\n  },\n  noShadow: {\n    boxShadow: \"none !important\",\n  },\n}));\n\nconst NotificationsPopOver = () => {\n  const classes = useStyles();\n\n  const history = useHistory();\n  const { user } = useContext(AuthContext);\n  const ticketIdUrl = +history.location.pathname.split(\"/\")[2];\n  const ticketIdRef = useRef(ticketIdUrl);\n  const anchorEl = useRef();\n  const [isOpen, setIsOpen] = useState(false);\n  const [notifications, setNotifications] = useState([]);\n  const { profile, queues } = user;\n\n  const [, setDesktopNotifications] = useState([]);\n\n  const { tickets } = useTickets({ withUnreadMessages: \"true\" });\n  const [play] = useSound(alertSound);\n  const soundAlertRef = useRef();\n\n  const historyRef = useRef(history);\n\n\tuseEffect(() => {\n\t\tsoundAlertRef.current = play;\n\n\t\tif (!(\"Notification\" in window)) {\n\t\t\tconsole.log(\"This browser doesn't support notifications\");\n\t\t} else {\n\t\t\tNotification.requestPermission();\n\t\t}\n\t}, [play]);\n\n\tuseEffect(() => {\n\t\tsetNotifications(tickets);\n\t}, [tickets]);\n\n\tuseEffect(() => {\n\t\tticketIdRef.current = ticketIdUrl;\n\t}, [ticketIdUrl]);\n\n  useEffect(() => {\n    const companyId = localStorage.getItem(\"companyId\");\n    const socket = socketConnection({ companyId });\n\n    const queueIds = queues.map((q) => q.id);\n\n    socket.on(\"connect\", () => socket.emit(\"joinNotification\"));\n\n    socket.on(`company-${companyId}-ticket`, (data) => {\n      if (data.action === \"updateUnread\" || data.action === \"delete\") {\n\t\t\t\tsetNotifications(prevState => {\n\t\t\t\t\tconst ticketIndex = prevState.findIndex(t => t.id === data.ticketId);\n\t\t\t\t\tif (ticketIndex !== -1) {\n\t\t\t\t\t\tprevState.splice(ticketIndex, 1);\n\t\t\t\t\t\treturn [...prevState];\n\t\t\t\t\t}\n\t\t\t\t\treturn prevState;\n\t\t\t\t});\n\n\t\t\t\tsetDesktopNotifications(prevState => {\n\t\t\t\t\tconst notfiticationIndex = prevState.findIndex(\n\t\t\t\t\t\tn => n.tag === String(data.ticketId)\n\t\t\t\t\t);\n\t\t\t\t\tif (notfiticationIndex !== -1) {\n\t\t\t\t\t\tprevState[notfiticationIndex].close();\n\t\t\t\t\t\tprevState.splice(notfiticationIndex, 1);\n\t\t\t\t\t\treturn [...prevState];\n\t\t\t\t\t}\n\t\t\t\t\treturn prevState;\n\t\t\t\t});\n      }\n    });\n\n    socket.on(`company-${companyId}-appMessage`, (data) => {\n\t\t\tif (\n\t\t\t\tdata.action === \"create\" &&\n\t\t\t\t!data.message.read &&\n\t\t\t\t(data.ticket.userId === user?.id || !data.ticket.userId)\n\t\t\t) {\n\t\t\t\tsetNotifications(prevState => {\n\t\t\t\t\tconst ticketIndex = prevState.findIndex(t => t.id === data.ticket.id);\n\t\t\t\t\tif (ticketIndex !== -1) {\n\t\t\t\t\t\tprevState[ticketIndex] = data.ticket;\n\t\t\t\t\t\treturn [...prevState];\n\t\t\t\t\t}\n\t\t\t\t\treturn [data.ticket, ...prevState];\n\t\t\t\t});\n\n\t\t\t\tconst shouldNotNotificate =\n\t\t\t\t\t(data.message.ticketId === ticketIdRef.current &&\n\t\t\t\t\t\tdocument.visibilityState === \"visible\") ||\n\t\t\t\t\t(data.ticket.userId && data.ticket.userId !== user?.id) ||\n\t\t\t\t\tdata.ticket.isGroup;\n\n\t\t\t\tif (shouldNotNotificate) return;\n\n\t\t\t\thandleNotifications(data);\n\t\t\t}\n    });\n\n    return () => {\n      socket.disconnect();\n    };\n  }, [user, profile, queues]);\n\n  const handleNotifications = (data) => {\n    const { message, contact, ticket } = data;\n\n    const options = {\n      body: `${message.body} - ${format(new Date(), \"HH:mm\")}`,\n      icon: contact.profilePicUrl,\n      tag: ticket.id,\n      renotify: true,\n    };\n\n    const notification = new Notification(\n      `${i18n.t(\"tickets.notification.message\")} ${contact.name}`,\n      options\n    );\n\n    notification.onclick = (e) => {\n      e.preventDefault();\n      window.focus();\n      historyRef.current.push(`/tickets/${ticket.uuid}`);\n    };\n\n    setDesktopNotifications((prevState) => {\n      const notfiticationIndex = prevState.findIndex(\n        (n) => n.tag === notification.tag\n      );\n      if (notfiticationIndex !== -1) {\n        prevState[notfiticationIndex] = notification;\n        return [...prevState];\n      }\n      return [notification, ...prevState];\n    });\n\n    soundAlertRef.current();\n  };\n\n  const handleClick = () => {\n    setIsOpen((prevState) => !prevState);\n  };\n\n  const handleClickAway = () => {\n    setIsOpen(false);\n  };\n\n  const NotificationTicket = ({ children }) => {\n    return <div onClick={handleClickAway}>{children}</div>;\n  };\n\n  return (\n    <>\n      <IconButton\n        onClick={handleClick}\n        ref={anchorEl}\n        aria-label=\"Mostrar Notificações\"\n        variant=\"contained\"\n\n      >\n          <ChatIcon />\n        {/* <Badge badgeContent={notifications.length} color=\"secondary\">\n        </Badge> */}\n      </IconButton>\n      <Popover\n        disableScrollLock\n        open={isOpen}\n        anchorEl={anchorEl.current}\n        anchorOrigin={{\n          vertical: \"bottom\",\n          horizontal: \"right\",\n        }}\n        transformOrigin={{\n          vertical: \"top\",\n          horizontal: \"right\",\n        }}\n        classes={{ paper: classes.popoverPaper }}\n        onClose={handleClickAway}\n      >\n        <List dense className={classes.tabContainer}>\n          {notifications.length === 0 ? (\n            <ListItem>\n              <ListItemText>{i18n.t(\"notifications.noTickets\")}</ListItemText>\n            </ListItem>\n          ) : (\n            notifications.map((ticket) => (\n              <NotificationTicket key={ticket.id}>\n                <TicketListItem ticket={ticket} />\n              </NotificationTicket>\n            ))\n          )}\n        </List>\n      </Popover>\n    </>\n  );\n};\n\nexport default NotificationsPopOver;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}