{"ast":null,"code":"import _slicedToArray from\"/Users/jucenirleonardo/Documents/GitHub/whaticket_saas/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _toConsumableArray from\"/Users/jucenirleonardo/Documents/GitHub/whaticket_saas/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/Users/jucenirleonardo/Documents/GitHub/whaticket_saas/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import React,{useState,useEffect,useReducer,useContext}from\"react\";import{makeStyles}from\"@material-ui/core/styles\";import List from\"@material-ui/core/List\";import Paper from\"@material-ui/core/Paper\";import TicketListItem from\"../TicketListItemCustom\";import TicketsListSkeleton from\"../TicketsListSkeleton\";import useTickets from\"../../hooks/useTickets\";import{i18n}from\"../../translate/i18n\";import{AuthContext}from\"../../context/Auth/AuthContext\";import{socketConnection}from\"../../services/socket\";var useStyles=makeStyles(function(theme){return{ticketsListWrapper:{position:\"relative\",display:\"flex\",height:\"100%\",flexDirection:\"column\",overflow:\"hidden\",borderTopRightRadius:0,borderBottomRightRadius:0},ticketsList:_objectSpread(_objectSpread({flex:1,maxHeight:\"100%\",overflowY:\"scroll\"},theme.scrollbarStyles),{},{borderTop:\"2px solid rgba(0, 0, 0, 0.12)\"}),ticketsListHeader:{color:\"rgb(67, 83, 105)\",zIndex:2,backgroundColor:\"white\",borderBottom:\"1px solid rgba(0, 0, 0, 0.12)\",display:\"flex\",alignItems:\"center\",justifyContent:\"space-between\"},ticketsCount:{fontWeight:\"normal\",color:\"rgb(104, 121, 146)\",marginLeft:\"8px\",fontSize:\"14px\"},noTicketsText:{textAlign:\"center\",color:\"rgb(104, 121, 146)\",fontSize:\"14px\",lineHeight:\"1.4\"},noTicketsTitle:{textAlign:\"center\",fontSize:\"16px\",fontWeight:\"600\",margin:\"0px\"},noTicketsDiv:{display:\"flex\",height:\"100px\",margin:40,flexDirection:\"column\",alignItems:\"center\",justifyContent:\"center\"}};});var reducer=function reducer(state,action){if(action.type===\"LOAD_TICKETS\"){var newTickets=action.payload;newTickets.forEach(function(ticket){var ticketIndex=state.findIndex(function(t){return t.id===ticket.id;});if(ticketIndex!==-1){state[ticketIndex]=ticket;if(ticket.unreadMessages>0){state.unshift(state.splice(ticketIndex,1)[0]);}}else{state.push(ticket);}});return _toConsumableArray(state);}if(action.type===\"RESET_UNREAD\"){var ticketId=action.payload;var ticketIndex=state.findIndex(function(t){return t.id===ticketId;});if(ticketIndex!==-1){state[ticketIndex].unreadMessages=0;}return _toConsumableArray(state);}if(action.type===\"UPDATE_TICKET\"){var ticket=action.payload;var _ticketIndex=state.findIndex(function(t){return t.id===ticket.id;});if(_ticketIndex!==-1){state[_ticketIndex]=ticket;}else{state.unshift(ticket);}return _toConsumableArray(state);}if(action.type===\"UPDATE_TICKET_UNREAD_MESSAGES\"){var _ticket=action.payload;var _ticketIndex2=state.findIndex(function(t){return t.id===_ticket.id;});if(_ticketIndex2!==-1){state[_ticketIndex2]=_ticket;state.unshift(state.splice(_ticketIndex2,1)[0]);}else{state.unshift(_ticket);}return _toConsumableArray(state);}if(action.type===\"UPDATE_TICKET_CONTACT\"){var contact=action.payload;var _ticketIndex3=state.findIndex(function(t){return t.contactId===contact.id;});if(_ticketIndex3!==-1){state[_ticketIndex3].contact=contact;}return _toConsumableArray(state);}if(action.type===\"DELETE_TICKET\"){var _ticketId=action.payload;var _ticketIndex4=state.findIndex(function(t){return t.id===_ticketId;});if(_ticketIndex4!==-1){state.splice(_ticketIndex4,1);}return _toConsumableArray(state);}if(action.type===\"RESET\"){return[];}};var TicketsListCustom=function TicketsListCustom(props){var status=props.status,searchParam=props.searchParam,tags=props.tags,users=props.users,showAll=props.showAll,selectedQueueIds=props.selectedQueueIds,updateCount=props.updateCount,style=props.style;var classes=useStyles();var _useState=useState(1),_useState2=_slicedToArray(_useState,2),pageNumber=_useState2[0],setPageNumber=_useState2[1];var _useReducer=useReducer(reducer,[]),_useReducer2=_slicedToArray(_useReducer,2),ticketsList=_useReducer2[0],dispatch=_useReducer2[1];var _useContext=useContext(AuthContext),user=_useContext.user;var profile=user.profile,queues=user.queues;useEffect(function(){dispatch({type:\"RESET\"});setPageNumber(1);},[status,searchParam,dispatch,showAll,tags,users,selectedQueueIds]);var _useTickets=useTickets({pageNumber:pageNumber,searchParam:searchParam,status:status,showAll:showAll,tags:JSON.stringify(tags),users:JSON.stringify(users),queueIds:JSON.stringify(selectedQueueIds)}),tickets=_useTickets.tickets,hasMore=_useTickets.hasMore,loading=_useTickets.loading;useEffect(function(){var queueIds=queues.map(function(q){return q.id;});var filteredTickets=tickets.filter(function(t){return queueIds.indexOf(t.queueId)>-1;});if(profile===\"user\"){dispatch({type:\"LOAD_TICKETS\",payload:filteredTickets});}else{dispatch({type:\"LOAD_TICKETS\",payload:tickets});}},[tickets,status,searchParam,queues,profile]);useEffect(function(){var companyId=localStorage.getItem(\"companyId\");var socket=socketConnection({companyId:companyId});var shouldUpdateTicket=function shouldUpdateTicket(ticket){return(!ticket.userId||ticket.userId===(user===null||user===void 0?void 0:user.id)||showAll)&&(!ticket.queueId||selectedQueueIds.indexOf(ticket.queueId)>-1);};var notBelongsToUserQueues=function notBelongsToUserQueues(ticket){return ticket.queueId&&selectedQueueIds.indexOf(ticket.queueId)===-1;};socket.on(\"connect\",function(){if(status){socket.emit(\"joinTickets\",status);}else{socket.emit(\"joinNotification\");}});socket.on(\"company-\".concat(companyId,\"-ticket\"),function(data){if(data.action===\"updateUnread\"){dispatch({type:\"RESET_UNREAD\",payload:data.ticketId});}if(data.action===\"update\"&&shouldUpdateTicket(data.ticket)){dispatch({type:\"UPDATE_TICKET\",payload:data.ticket});}if(data.action===\"update\"&&notBelongsToUserQueues(data.ticket)){dispatch({type:\"DELETE_TICKET\",payload:data.ticket.id});}if(data.action===\"delete\"){dispatch({type:\"DELETE_TICKET\",payload:data.ticketId});}});socket.on(\"company-\".concat(companyId,\"-appMessage\"),function(data){var _data$ticket$queue;var queueIds=queues.map(function(q){return q.id;});if(profile===\"user\"&&(queueIds.indexOf((_data$ticket$queue=data.ticket.queue)===null||_data$ticket$queue===void 0?void 0:_data$ticket$queue.id)===-1||data.ticket.queue===null)){return;}if(data.action===\"create\"&&shouldUpdateTicket(data.ticket)){dispatch({type:\"UPDATE_TICKET_UNREAD_MESSAGES\",payload:data.ticket});}});socket.on(\"company-\".concat(companyId,\"-contact\"),function(data){if(data.action===\"update\"){dispatch({type:\"UPDATE_TICKET_CONTACT\",payload:data.contact});}});return function(){socket.disconnect();};},[status,showAll,user,selectedQueueIds,tags,users,profile,queues]);useEffect(function(){if(typeof updateCount===\"function\"){updateCount(ticketsList.length);}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[ticketsList]);var loadMore=function loadMore(){setPageNumber(function(prevState){return prevState+1;});};var handleScroll=function handleScroll(e){if(!hasMore||loading)return;var _e$currentTarget=e.currentTarget,scrollTop=_e$currentTarget.scrollTop,scrollHeight=_e$currentTarget.scrollHeight,clientHeight=_e$currentTarget.clientHeight;if(scrollHeight-(scrollTop+100)<clientHeight){loadMore();}};return/*#__PURE__*/React.createElement(Paper,{className:classes.ticketsListWrapper,style:style},/*#__PURE__*/React.createElement(Paper,{square:true,name:\"closed\",elevation:0,className:classes.ticketsList,onScroll:handleScroll},/*#__PURE__*/React.createElement(List,{style:{paddingTop:0}},ticketsList.length===0&&!loading?/*#__PURE__*/React.createElement(\"div\",{className:classes.noTicketsDiv},/*#__PURE__*/React.createElement(\"span\",{className:classes.noTicketsTitle},i18n.t(\"ticketsList.noTicketsTitle\")),/*#__PURE__*/React.createElement(\"p\",{className:classes.noTicketsText},i18n.t(\"ticketsList.noTicketsMessage\"))):/*#__PURE__*/React.createElement(React.Fragment,null,ticketsList.map(function(ticket){return/*#__PURE__*/React.createElement(TicketListItem,{ticket:ticket,key:ticket.id});})),loading&&/*#__PURE__*/React.createElement(TicketsListSkeleton,null))));};export default TicketsListCustom;","map":null,"metadata":{},"sourceType":"module"}