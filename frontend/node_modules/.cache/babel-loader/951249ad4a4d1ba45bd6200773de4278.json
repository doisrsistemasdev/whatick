{"ast":null,"code":"var _jsxFileName = \"/Users/jucenirleonardo/Documents/GitHub/whaticket_saas/frontend/src/pages/Chat/ChatPopover.js\";\nimport React, { useContext, useEffect, useReducer, useRef, useState } from \"react\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport toastError from \"../../errors/toastError\";\nimport Popover from \"@material-ui/core/Popover\";\nimport ForumIcon from \"@material-ui/icons/Forum\";\nimport { Badge, IconButton, List, ListItem, ListItemText, Paper, Typography } from \"@material-ui/core\";\nimport api from \"../../services/api\";\nimport { isArray } from \"lodash\";\nimport { socketConnection } from \"../../services/socket\";\nimport { useDate } from \"../../hooks/useDate\";\nimport { AuthContext } from \"../../context/Auth/AuthContext\";\nimport notifySound from \"../../assets/chat_notify.mp3\";\nimport useSound from \"use-sound\";\nconst useStyles = makeStyles(theme => ({\n  mainPaper: {\n    flex: 1,\n    maxHeight: 300,\n    maxWidth: 500,\n    padding: theme.spacing(1),\n    overflowY: \"scroll\",\n    ...theme.scrollbarStyles\n  }\n}));\nconst reducer = (state, action) => {\n  if (action.type === \"LOAD_CHATS\") {\n    const chats = action.payload;\n    const newChats = [];\n    if (isArray(chats)) {\n      chats.forEach(chat => {\n        const chatIndex = state.findIndex(u => u.id === chat.id);\n        if (chatIndex !== -1) {\n          state[chatIndex] = chat;\n        } else {\n          newChats.push(chat);\n        }\n      });\n    }\n    return [...state, ...newChats];\n  }\n  if (action.type === \"UPDATE_CHATS\") {\n    const chat = action.payload;\n    const chatIndex = state.findIndex(u => u.id === chat.id);\n    if (chatIndex !== -1) {\n      state[chatIndex] = chat;\n      return [...state];\n    } else {\n      return [chat, ...state];\n    }\n  }\n  if (action.type === \"DELETE_CHAT\") {\n    const chatId = action.payload;\n    const chatIndex = state.findIndex(u => u.id === chatId);\n    if (chatIndex !== -1) {\n      state.splice(chatIndex, 1);\n    }\n    return [...state];\n  }\n  if (action.type === \"RESET\") {\n    return [];\n  }\n  if (action.type === \"CHANGE_CHAT\") {\n    const changedChats = state.map(chat => {\n      if (chat.id === action.payload.chat.id) {\n        return action.payload.chat;\n      }\n      return chat;\n    });\n    return changedChats;\n  }\n};\nexport default function ChatPopover() {\n  const classes = useStyles();\n  const {\n    user\n  } = useContext(AuthContext);\n  const [loading, setLoading] = useState(false);\n  const [anchorEl, setAnchorEl] = useState(null);\n  const [pageNumber, setPageNumber] = useState(1);\n  const [hasMore, setHasMore] = useState(false);\n  const [searchParam] = useState(\"\");\n  const [chats, dispatch] = useReducer(reducer, []);\n  const [invisible, setInvisible] = useState(true);\n  const {\n    datetimeToClient\n  } = useDate();\n  const [play] = useSound(notifySound);\n  const soundAlertRef = useRef();\n  useEffect(() => {\n    soundAlertRef.current = play;\n    if (!(\"Notification\" in window)) {\n      console.log(\"This browser doesn't support notifications\");\n    } else {\n      Notification.requestPermission();\n    }\n  }, [play]);\n  useEffect(() => {\n    dispatch({\n      type: \"RESET\"\n    });\n    setPageNumber(1);\n  }, [searchParam]);\n  useEffect(() => {\n    setLoading(true);\n    const delayDebounceFn = setTimeout(() => {\n      fetchChats();\n    }, 500);\n    return () => clearTimeout(delayDebounceFn);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [searchParam, pageNumber]);\n  useEffect(() => {\n    const companyId = localStorage.getItem(\"companyId\");\n    const socket = socketConnection({\n      companyId\n    });\n    socket.on(`company-${companyId}-chat`, data => {\n      if (data.action === \"new-message\") {\n        dispatch({\n          type: \"CHANGE_CHAT\",\n          payload: data\n        });\n        if (data.newMessage.senderId !== user.id) {\n          console.log(data);\n          soundAlertRef.current();\n        }\n      }\n      if (data.action === \"update\") {\n        dispatch({\n          type: \"CHANGE_CHAT\",\n          payload: data\n        });\n      }\n    });\n    return () => {\n      socket.disconnect();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  useEffect(() => {\n    let unreadsCount = 0;\n    if (chats.length > 0) {\n      for (let chat of chats) {\n        for (let chatUser of chat.users) {\n          if (chatUser.userId === user.id) {\n            unreadsCount += chatUser.unreads;\n          }\n        }\n      }\n    }\n    if (unreadsCount > 0) {\n      setInvisible(false);\n    } else {\n      setInvisible(true);\n    }\n  }, [chats, user.id]);\n  const fetchChats = async () => {\n    try {\n      const {\n        data\n      } = await api.get(\"/chats/\", {\n        params: {\n          searchParam,\n          pageNumber\n        }\n      });\n      dispatch({\n        type: \"LOAD_CHATS\",\n        payload: data.records\n      });\n      setHasMore(data.hasMore);\n      setLoading(false);\n    } catch (err) {\n      toastError(err);\n    }\n  };\n  const loadMore = () => {\n    setPageNumber(prevState => prevState + 1);\n  };\n  const handleScroll = e => {\n    if (!hasMore || loading) return;\n    const {\n      scrollTop,\n      scrollHeight,\n      clientHeight\n    } = e.currentTarget;\n    if (scrollHeight - (scrollTop + 100) < clientHeight) {\n      loadMore();\n    }\n  };\n  const handleClick = event => {\n    setAnchorEl(event.currentTarget);\n    setInvisible(true);\n  };\n  const handleClose = () => {\n    setAnchorEl(null);\n  };\n  const goToMessages = chat => {\n    window.location.href = `/chats/${chat.uuid}`;\n  };\n  const open = Boolean(anchorEl);\n  const id = open ? \"simple-popover\" : undefined;\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(IconButton, {\n    \"aria-describedby\": id,\n    variant: \"contained\",\n    color: invisible ? \"default\" : \"inherit\",\n    onClick: handleClick,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Badge, {\n    color: \"secondary\",\n    variant: \"dot\",\n    invisible: invisible,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(ForumIcon, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 227,\n      columnNumber: 11\n    }\n  }))), /*#__PURE__*/React.createElement(Popover, {\n    id: id,\n    open: open,\n    anchorEl: anchorEl,\n    onClose: handleClose,\n    anchorOrigin: {\n      vertical: \"bottom\",\n      horizontal: \"center\"\n    },\n    transformOrigin: {\n      vertical: \"top\",\n      horizontal: \"center\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Paper, {\n    variant: \"outlined\",\n    onScroll: handleScroll,\n    className: classes.mainPaper,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 244,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(List, {\n    component: \"nav\",\n    \"aria-label\": \"main mailbox folders\",\n    style: {\n      minWidth: 300\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 249,\n      columnNumber: 11\n    }\n  }, isArray(chats) && chats.map((item, key) => /*#__PURE__*/React.createElement(ListItem, {\n    key: key,\n    style: {\n      background: key % 2 === 0 ? \"#ededed\" : \"white\",\n      border: \"1px solid #eee\",\n      cursor: \"pointer\"\n    },\n    onClick: () => goToMessages(item),\n    button: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 256,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(ListItemText, {\n    primary: item.lastMessage,\n    secondary: /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Typography, {\n      component: \"span\",\n      style: {\n        fontSize: 12\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 270,\n        columnNumber: 25\n      }\n    }, datetimeToClient(item.updatedAt)), /*#__PURE__*/React.createElement(\"span\", {\n      style: {\n        marginTop: 5,\n        display: \"block\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 273,\n        columnNumber: 25\n      }\n    })),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 266,\n      columnNumber: 19\n    }\n  }))), isArray(chats) && chats.length === 0 && /*#__PURE__*/React.createElement(ListItemText, {\n    primary: \"Nenhum registro\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 280,\n      columnNumber: 15\n    }\n  })))));\n}","map":{"version":3,"names":["React","useContext","useEffect","useReducer","useRef","useState","makeStyles","toastError","Popover","ForumIcon","Badge","IconButton","List","ListItem","ListItemText","Paper","Typography","api","isArray","socketConnection","useDate","AuthContext","notifySound","useSound","useStyles","theme","mainPaper","flex","maxHeight","maxWidth","padding","spacing","overflowY","scrollbarStyles","reducer","state","action","type","chats","payload","newChats","forEach","chat","chatIndex","findIndex","u","id","push","chatId","splice","changedChats","map","ChatPopover","classes","user","loading","setLoading","anchorEl","setAnchorEl","pageNumber","setPageNumber","hasMore","setHasMore","searchParam","dispatch","invisible","setInvisible","datetimeToClient","play","soundAlertRef","current","window","console","log","Notification","requestPermission","delayDebounceFn","setTimeout","fetchChats","clearTimeout","companyId","localStorage","getItem","socket","on","data","newMessage","senderId","disconnect","unreadsCount","length","chatUser","users","userId","unreads","get","params","records","err","loadMore","prevState","handleScroll","e","scrollTop","scrollHeight","clientHeight","currentTarget","handleClick","event","handleClose","goToMessages","location","href","uuid","open","Boolean","undefined","createElement","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","variant","color","onClick","onClose","anchorOrigin","vertical","horizontal","transformOrigin","onScroll","className","component","style","minWidth","item","key","background","border","cursor","button","primary","lastMessage","secondary","Fragment","fontSize","updatedAt","marginTop","display"],"sources":["/Users/jucenirleonardo/Documents/GitHub/whaticket_saas/frontend/src/pages/Chat/ChatPopover.js"],"sourcesContent":["import React, {\n  useContext,\n  useEffect,\n  useReducer,\n  useRef,\n  useState,\n} from \"react\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport toastError from \"../../errors/toastError\";\nimport Popover from \"@material-ui/core/Popover\";\nimport ForumIcon from \"@material-ui/icons/Forum\";\nimport {\n  Badge,\n  IconButton,\n  List,\n  ListItem,\n  ListItemText,\n  Paper,\n  Typography,\n} from \"@material-ui/core\";\nimport api from \"../../services/api\";\nimport { isArray } from \"lodash\";\nimport { socketConnection } from \"../../services/socket\";\nimport { useDate } from \"../../hooks/useDate\";\nimport { AuthContext } from \"../../context/Auth/AuthContext\";\n\nimport notifySound from \"../../assets/chat_notify.mp3\";\nimport useSound from \"use-sound\";\n\nconst useStyles = makeStyles((theme) => ({\n  mainPaper: {\n    flex: 1,\n    maxHeight: 300,\n    maxWidth: 500,\n    padding: theme.spacing(1),\n    overflowY: \"scroll\",\n    ...theme.scrollbarStyles,\n  },\n}));\n\nconst reducer = (state, action) => {\n  if (action.type === \"LOAD_CHATS\") {\n    const chats = action.payload;\n    const newChats = [];\n\n    if (isArray(chats)) {\n      chats.forEach((chat) => {\n        const chatIndex = state.findIndex((u) => u.id === chat.id);\n        if (chatIndex !== -1) {\n          state[chatIndex] = chat;\n        } else {\n          newChats.push(chat);\n        }\n      });\n    }\n\n    return [...state, ...newChats];\n  }\n\n  if (action.type === \"UPDATE_CHATS\") {\n    const chat = action.payload;\n    const chatIndex = state.findIndex((u) => u.id === chat.id);\n\n    if (chatIndex !== -1) {\n      state[chatIndex] = chat;\n      return [...state];\n    } else {\n      return [chat, ...state];\n    }\n  }\n\n  if (action.type === \"DELETE_CHAT\") {\n    const chatId = action.payload;\n\n    const chatIndex = state.findIndex((u) => u.id === chatId);\n    if (chatIndex !== -1) {\n      state.splice(chatIndex, 1);\n    }\n    return [...state];\n  }\n\n  if (action.type === \"RESET\") {\n    return [];\n  }\n\n  if (action.type === \"CHANGE_CHAT\") {\n    const changedChats = state.map((chat) => {\n      if (chat.id === action.payload.chat.id) {\n        return action.payload.chat;\n      }\n      return chat;\n    });\n    return changedChats;\n  }\n};\n\nexport default function ChatPopover() {\n  const classes = useStyles();\n\n  const { user } = useContext(AuthContext);\n\n  const [loading, setLoading] = useState(false);\n  const [anchorEl, setAnchorEl] = useState(null);\n  const [pageNumber, setPageNumber] = useState(1);\n  const [hasMore, setHasMore] = useState(false);\n  const [searchParam] = useState(\"\");\n  const [chats, dispatch] = useReducer(reducer, []);\n  const [invisible, setInvisible] = useState(true);\n  const { datetimeToClient } = useDate();\n  const [play] = useSound(notifySound);\n  const soundAlertRef = useRef();\n\n  useEffect(() => {\n    soundAlertRef.current = play;\n\n    if (!(\"Notification\" in window)) {\n      console.log(\"This browser doesn't support notifications\");\n    } else {\n      Notification.requestPermission();\n    }\n  }, [play]);\n\n  useEffect(() => {\n    dispatch({ type: \"RESET\" });\n    setPageNumber(1);\n  }, [searchParam]);\n\n  useEffect(() => {\n    setLoading(true);\n    const delayDebounceFn = setTimeout(() => {\n      fetchChats();\n    }, 500);\n    return () => clearTimeout(delayDebounceFn);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [searchParam, pageNumber]);\n\n  useEffect(() => {\n    const companyId = localStorage.getItem(\"companyId\");\n    const socket = socketConnection({ companyId });\n\n    socket.on(`company-${companyId}-chat`, (data) => {\n      if (data.action === \"new-message\") {\n        dispatch({ type: \"CHANGE_CHAT\", payload: data });\n        if (data.newMessage.senderId !== user.id) {\n          console.log(data);\n          soundAlertRef.current();\n        }\n      }\n      if (data.action === \"update\") {\n        dispatch({ type: \"CHANGE_CHAT\", payload: data });\n      }\n    });\n    return () => {\n      socket.disconnect();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffect(() => {\n    let unreadsCount = 0;\n    if (chats.length > 0) {\n      for (let chat of chats) {\n        for (let chatUser of chat.users) {\n          if (chatUser.userId === user.id) {\n            unreadsCount += chatUser.unreads;\n          }\n        }\n      }\n    }\n    if (unreadsCount > 0) {\n      setInvisible(false);\n    } else {\n      setInvisible(true);\n    }\n  }, [chats, user.id]);\n\n  const fetchChats = async () => {\n    try {\n      const { data } = await api.get(\"/chats/\", {\n        params: { searchParam, pageNumber },\n      });\n      dispatch({ type: \"LOAD_CHATS\", payload: data.records });\n      setHasMore(data.hasMore);\n      setLoading(false);\n    } catch (err) {\n      toastError(err);\n    }\n  };\n\n  const loadMore = () => {\n    setPageNumber((prevState) => prevState + 1);\n  };\n\n  const handleScroll = (e) => {\n    if (!hasMore || loading) return;\n    const { scrollTop, scrollHeight, clientHeight } = e.currentTarget;\n    if (scrollHeight - (scrollTop + 100) < clientHeight) {\n      loadMore();\n    }\n  };\n\n  const handleClick = (event) => {\n    setAnchorEl(event.currentTarget);\n    setInvisible(true);\n  };\n\n  const handleClose = () => {\n    setAnchorEl(null);\n  };\n\n  const goToMessages = (chat) => {\n    window.location.href = `/chats/${chat.uuid}`;\n  };\n\n  const open = Boolean(anchorEl);\n  const id = open ? \"simple-popover\" : undefined;\n\n  return (\n    <div>\n      <IconButton\n        aria-describedby={id}\n        variant=\"contained\"\n        color={invisible ? \"default\" : \"inherit\"}\n        onClick={handleClick}\n      >\n        <Badge color=\"secondary\" variant=\"dot\" invisible={invisible}>\n          <ForumIcon />\n        </Badge>\n      </IconButton>\n      <Popover\n        id={id}\n        open={open}\n        anchorEl={anchorEl}\n        onClose={handleClose}\n        anchorOrigin={{\n          vertical: \"bottom\",\n          horizontal: \"center\",\n        }}\n        transformOrigin={{\n          vertical: \"top\",\n          horizontal: \"center\",\n        }}\n      >\n        <Paper\n          variant=\"outlined\"\n          onScroll={handleScroll}\n          className={classes.mainPaper}\n        >\n          <List\n            component=\"nav\"\n            aria-label=\"main mailbox folders\"\n            style={{ minWidth: 300 }}\n          >\n            {isArray(chats) &&\n              chats.map((item, key) => (\n                <ListItem\n                  key={key}\n                  style={{\n                    background: key % 2 === 0 ? \"#ededed\" : \"white\",\n                    border: \"1px solid #eee\",\n                    cursor: \"pointer\",\n                  }}\n                  onClick={() => goToMessages(item)}\n                  button\n                >\n                  <ListItemText\n                    primary={item.lastMessage}\n                    secondary={\n                      <>\n                        <Typography component=\"span\" style={{ fontSize: 12 }}>\n                          {datetimeToClient(item.updatedAt)}\n                        </Typography>\n                        <span style={{ marginTop: 5, display: \"block\" }}></span>\n                      </>\n                    }\n                  />\n                </ListItem>\n              ))}\n            {isArray(chats) && chats.length === 0 && (\n              <ListItemText primary=\"Nenhum registro\" />\n            )}\n          </List>\n        </Paper>\n      </Popover>\n    </div>\n  );\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}